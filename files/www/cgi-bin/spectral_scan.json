#!/bin/sh
phy=phy0

### sample current channel only, no freq hopping
echo manual > /sys/kernel/debug/ieee80211/$phy/ath9k/spectral_scan_ctl 
echo 1 > /sys/kernel/debug/ieee80211/$phy/ath9k/spectral_count
echo trigger > /sys/kernel/debug/ieee80211/$phy/ath9k/spectral_scan_ctl 

### grab samples over the whole spectrum
#echo chanscan > /sys/kernel/debug/ieee80211/$phy/ath9k/spectral_scan_ctl 
#iw wlan0 scan trigger freq 2412 2432 2452 2472

echo HTTP/1.1 200 OK
echo Transfer-Encoding: chunked
echo Content-Type: application/json
echo Cache-Control: no-cache
echo Expires: 0
echo
echo '['
fft_eval /sys/kernel/debug/ieee80211/$phy/ath9k/spectral_scan0 2>/dev/null
echo ']'
